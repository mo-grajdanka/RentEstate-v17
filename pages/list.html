<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="page-title">(Лого) Название компании</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="../style/style.css">
  <script defer src="../js/modal.js"></script>
  <script defer src="../js/script.js"></script>
  <script defer src="../js/burger.js"></script>

</head>

<body class="flex flex-col min-h-screen bg-gray-50 font-sans">
  <script src="data.js"></script>
  <!-- <script src="filters.js"></script> -->
  <!-- Header -->
    <header class="bg-gray-100 sticky top-0 z-50 shadow-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center">
                <!-- <div class="text-2xl font-bold text-blue-600">RE</div> -->
                <a href="/" class="ml-2 text-xl font-semibold flex items-center hover:text-blue-600 transition">
  <span class="mr-2">(Лого)</span>
  <span>Название компании</span>
</a>
            </div>

            <!-- мобильное меню -->
             <nav id="mobileMenu" class="hidden fixed top-16 right-0 w-64 bg-white shadow-md py-4 px-6 space-y-4">
                <a href="#" class="block text-gray-700 hover:text-blue-600">Недвижимость</a>
                <a href="#" class="block text-gray-700 hover:text-blue-600">Услуги</a>
                <a href="#" class="block text-gray-700 hover:text-blue-600">Компания</a>
                <a href="#" class="block text-gray-700 hover:text-blue-600">Поддержка</a>
                <a href="tel:+71231232827" class="block text-gray-700 hover:text-blue-600">+7 (123) 123‑28‑27</a>
            </nav>


            <div class="flex items-center space-x-4">
                <button id="openModalBtn"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition">
                    Заказать звонок
                </button>
                <div class="hidden md:block">
                    <a href="tel:+71231232827" class="text-gray-700 hover:text-blue-600">+7 (123) 123–28–27</a>
                </div>

                <!-- <button class="md:hidden text-gray-700">
                    <i class="fas fa-bars text-xl"></i>
                </button> -->
                <button id="burger" class="text-gray-700 hamburger-menu flex flex-col gap-1 p-2 cursor-pointer">
                    <span class="block w-5 h-0.5 bg-gray-700 transition-all duration-300"></span>
                    <span class="block w-5 h-0.5 bg-gray-700 transition-all duration-300"></span>
                    <span class="block w-5 h-0.5 bg-gray-700 transition-all duration-300"></span>
                </button>
            </div>
        </div>
    </header>

  

  <main class="flex-grow container mx-auto px-4 py-8">
    <!-- Breadcrumbs -->
    <nav class="text-sm text-gray-500 mb-4" aria-label="breadcrumb">
      <ol class="inline-flex list-none p-0">
        <li class="flex items-center">
          <a href="../index.html" class="hover:text-gray-700">Главная</a>
          <span class="mx-2">/</span>
        </li>
        <li class="flex items-center">
          <span id="bc-list" class="text-gray-700">…</span>
        </li>
      </ol>
    </nav>

    <!-- Page title -->
    <h1 id="page-title-heading" class="text-3xl font-bold mb-6"></h1>

    <!-- Фильтры -->
    <section class="container mx-auto mb-6">
      <div class="flex flex-wrap gap-4">
        <!-- Фильтр: Площадка -->
        <div class="relative inline-block" data-filter-key="place">
          <button
            class="filter-toggle flex items-center gap-2 px-4 py-2
           bg-gray-100 text-gray-700 hover:bg-indigo-600 hover:text-white transition
           border border-gray-300 border-r-0 rounded-none"
            data-placeholder="Площадка"> 
            <span class="filter-label">Площадка</span>
            <i class="fas fa-chevron-down"></i>
          </button>
          <ul class="filter-options hidden absolute left-0 mt-2 bg-white rounded-lg shadow-lg py-2 w-full z-50">
            
          </ul>
        </div>

        <!-- Фильтр: Назначение -->
        <div class="relative inline-block" data-filter-key="purpose">
          <button
            class="filter-toggle flex items-center gap-2 px-4 py-2
           bg-gray-100 text-gray-700 hover:bg-indigo-600 hover:text-white transition
           border border-gray-300 border-r-0 rounded-none"
            data-placeholder="Назначение">
            <span class="filter-label">Назначение</span>
            <i class="fas fa-chevron-down"></i>
          </button>
          <ul class="filter-options hidden absolute left-0 mt-2 bg-white rounded-lg shadow-lg py-2 w-full z-50">
          </ul>
        </div>

        <!-- Фильтр: Площадь от -->
        <div class="relative inline-block" data-filter-key="minArea">
          <button class="filter-toggle flex items-center gap-2 px-4 py-2
           bg-gray-100 text-gray-700 hover:bg-indigo-600 hover:text-white transition
           border border-gray-300 border-r-0 rounded-none">
            <span class="filter-label"></span>
            <i class="fas fa-chevron-down"></i>
          </button>
          <ul class="filter-options absolute left-0 mt-2 bg-white shadow rounded py-2 w-full z-50"></ul>
        </div>

        <!-- Фильтр: Площадь до -->
        <div class="relative inline-block" data-filter-key="maxArea">
          <button class="filter-toggle flex items-center gap-2 px-4 py-2
           bg-gray-100 text-gray-700 hover:bg-indigo-600 hover:text-white transition
           border border-gray-300 border-r-0 rounded-none">
            <span class="filter-label"></span>
            <i class="fas fa-chevron-down"></i>
          </button>
          <ul class="filter-options absolute left-0 mt-2 bg-white shadow rounded py-2 w-full z-50"></ul>
        </div>
      </div>
      </div>
    </section>

    <style>
      .filter-options {
        display: none;
      }

      .filter-options.show {
        display: block;
      }

      .filter-label--dynamic {
        font-style: italic;
      }
    </style>

    <!-- Listings grid -->
    <div id="listings" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
  </main>

  <!-- Footer -->
  <footer class="mt-auto bg-gray-900 text-gray-300 pt-16 pb-8">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-12">
        <!-- Column 1 -->
        <div>
          <div class="flex items-center mb-4">
            <!-- <div class="text-2xl font-bold text-white">RE</div> -->
            <div class="ml-2 text-xl font-semibold text-white">(Лого) Название компании</div>
          </div>
          <p class="mb-4">
            Ведущая компания по аренде недвижимости в Санкт-Петербурге
          </p>
          <div class="flex space-x-4">
            <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-facebook-f"></i></a>
            <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-instagram"></i></a>
            <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-telegram"></i></a>
            <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-vk"></i></a>
          </div>
        </div>

        <!-- Column 2 -->
        <div>
          <h3 class="text-white text-lg font-semibold mb-4">Недвижимость</h3>
          <ul class="space-y-2">
            <!-- <li><a href="#" class="hover:text-white">Квартиры</a></li> -->
            <!-- <li><a href="#" class="hover:text-white">Дома</a></li> -->
            <li><a href="#" class="hover:text-white">Офисы</a></li>
            <li><a href="#" class="hover:text-white">Коммерческая недвижимость</a></li>
            <!-- <li><a href="#" class="hover:text-white">Новостройки</a></li> -->
          </ul>
        </div>

        <!-- Column 3 -->
        <div>
          <h3 class="text-white text-lg font-semibold mb-4">Услуги</h3>
          <ul class="space-y-2">
            <li><a href="#" class="hover:text-white">Аренда жилья</a></li>
            <li><a href="#" class="hover:text-white">Аренда офисов</a></li>
            <li><a href="#" class="hover:text-white">Юридические услуги</a></li>
            <li><a href="#" class="hover:text-white">Оценка недвижимости</a></li>
            <li><a href="#" class="hover:text-white">Консультации</a></li>
          </ul>
        </div>

        <!-- Column 4 -->
        <div>
          <h3 class="text-white text-lg font-semibold mb-4">Контакты</h3>
          <ul class="space-y-2">
            <li class="flex items-start">
              <i class="fas fa-phone-alt mt-1 mr-2"></i>
              <div>
                <a href="tel:+71231232827" class="hover:text-white">+7 (123) 123–28–27</a>
                <p class="text-sm text-gray-400">Ежедневно с 9:00 до 21:00</p>
              </div>
            </li>
            <li class="flex items-center">
              <i class="fas fa-envelope mr-2"></i>
              <a href="mailto:info@(Лого) Название компании.ru" class="hover:text-white">info@(Лого) Название
                компании.ru</a>
            </li>
            <li class="flex items-center">
              <i class="fas fa-map-marker-alt mr-2"></i>
              <span>Санкт-Петербург, Невский пр. 100</span>
            </li>
          </ul>
        </div>
      </div>

      <div class="border-t border-gray-800 pt-8 flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          © 2024 (Лого) Название компании. Все права защищены.
        </div>
        <div class="flex space-x-4">
          <a href="#" class="hover:text-white">Условия использования</a>
          <a href="#" class="hover:text-white">Политика конфиденциальности</a>
          <a href="#" class="hover:text-white">Карта сайта</a>
        </div>
      </div>
    </div>
  </footer>
<script>
// 1. Маппинг названий назначения
const labels = {
  land:       'Земельные участки',
  office:     'Офисные помещения',
  warehouse:  'Складские помещения',
  production: 'Производственные',
  retail:     'Торговые площади'
};

// 2. Обновление хлебных крошек и заголовка
function updateBreadcrumbAndHeading(purpose) {
  const bc = document.getElementById('bc-list');
  const h1 = document.getElementById('page-title-heading');
  if (purpose && labels[purpose]) {
    bc.textContent = labels[purpose];
    h1.textContent = labels[purpose];
    document.title = labels[purpose];
  } else {
    bc.textContent = 'Результаты поиска';
    h1.textContent = 'Результаты поиска';
    document.title = 'Результаты поиска';
  }
}

// 3. Бургер-меню
// const burger = document.querySelector('.hamburger-menu');
// if (burger) {
//   burger.addEventListener('click', () => {
//     document.getElementById('mobileMenu').classList.toggle('hidden');
//     burger.classList.toggle('active');
//   });
// }

// 18. Слайдер автопрокрутка и кнопки
function initEmptySlider() {
  const slider = document.querySelector('.overflow-x-auto');
  if (!slider) return;
  const cards = slider.querySelectorAll('.w-64');
  // Если карточек меньше 2 — убираем прокрутку
  if (cards.length <= 1) {
    slider.style.overflow = 'hidden';
    return;
  }

  const cardWidth = cards[0].offsetWidth + 16; // +gap
  let pos = 0;

  // Автопрокрутка каждые 4 секунды
  setInterval(() => {
    pos = (pos + cardWidth >= slider.scrollWidth - slider.clientWidth)
      ? 0
      : pos + cardWidth;
    slider.scrollTo({ left: pos, behavior: 'smooth' });
  }, 4000);

  // Кнопки «‹» и «›»
  const nav = document.createElement('div');
  nav.className = 'absolute top-1/2 left-0 right-0 flex justify-between items-center pointer-events-none';

  const btnPrev = document.createElement('button');
  btnPrev.innerHTML = '&#10094;'; // ‹
  btnPrev.className = 'pointer-events-auto bg-white rounded-full p-2 shadow';

  const btnNext = document.createElement('button');
  btnNext.innerHTML = '&#10095;'; // ›
  btnNext.className = 'pointer-events-auto bg-white rounded-full p-2 shadow';

  nav.append(btnPrev, btnNext);
  slider.parentElement.style.position = 'relative';
  slider.parentElement.append(nav);

  btnPrev.addEventListener('click', () => {
    pos = Math.max(0, pos - cardWidth);
    slider.scrollTo({ left: pos, behavior: 'smooth' });
  });
  btnNext.addEventListener('click', () => {
    pos = Math.min(slider.scrollWidth - slider.clientWidth, pos + cardWidth);
    slider.scrollTo({ left: pos, behavior: 'smooth' });
  });
}
document.addEventListener('DOMContentLoaded', initEmptySlider);
// document.addEventListener('DOMContentLoaded', () => initEmptySlider());
// 4. Инициализация после загрузки DOM
document.addEventListener('DOMContentLoaded', () => {
  const url = new URL(window.location);
  const filters = {
    purpose: url.searchParams.get('purpose') || '',
    place:   url.searchParams.get('place')   || '',
    minArea: url.searchParams.get('minArea') || '',
    maxArea: url.searchParams.get('maxArea') || ''
  };
  const suitableFilters = url.searchParams.getAll('suitableFor')
    .map(decodeURIComponent)
    .filter(Boolean);

  // Обновляем заголовок и хлебные крошки
  updateBreadcrumbAndHeading(filters.purpose);

  // Собираем данные для отображения
  const dataToShow = filters.purpose && dataByPurpose[filters.purpose]
    ? dataByPurpose[filters.purpose]
    : Object.values(dataByPurpose).flat();

  // 5. Авто-диапазон площадей
  const uniqueAreas = Array.from(new Set(
    dataToShow.map(i => Number(i.area)).filter(n => !isNaN(n))
  )).sort((a, b) => a - b);
  if (!filters.minArea && uniqueAreas.length) {
    filters.minArea = String(uniqueAreas[0]);
    url.searchParams.set('minArea', filters.minArea);
  }
  if (!filters.maxArea && uniqueAreas.length) {
    filters.maxArea = String(uniqueAreas[uniqueAreas.length - 1]);
    url.searchParams.set('maxArea', filters.maxArea);
  }
  history.replaceState(null, '', url);

  // 6. Генерация опций фильтров
  generatePurposeOptions();
  buildPlaceOptions();
  buildAreaOptions('minArea');
  buildAreaOptions('maxArea');

  // 7. Установка лейблов
  updateFilterButtonLabels(filters);

  // 8. Рендер и навешивание обработчиков
  renderListings(filters, suitableFilters);
  attachFilterHandlers(filters, url, suitableFilters);
});

// 9. Опции назначения
function generatePurposeOptions() {
  const wrapper = document.querySelector('[data-filter-key="purpose"] .filter-options');
  if (!wrapper) return;
  wrapper.innerHTML = Object.keys(dataByPurpose)
    .map(k => `<li><a href='#' data-value='${k}' class='block px-4 py-2 hover:bg-purple-100'>${labels[k]}</a></li>`)
    .join('');
}

// 10. Опции площадок
function buildPlaceOptions() {
  const wrapper = document.querySelector('[data-filter-key="place"] .filter-options');
  if (!wrapper) return;
  const all = Object.values(dataByPurpose).flat();
  const places = Array.from(new Set(all.map(i => i.place))).filter(Boolean);
  wrapper.innerHTML = places
    .map(p => `<li><a href='#' data-value='${p}' class='block px-4 py-2 hover:bg-purple-100'>${p}</a></li>`)
    .join('');
}

// 11. Опции площадей
function buildAreaOptions(filterKey) {
  const wrapper = document.querySelector(`[data-filter-key='${filterKey}'] .filter-options`);
  if (!wrapper) return;
  const all = Object.values(dataByPurpose).flat();
  const areas = Array.from(new Set(all.map(i => Number(i.area)).filter(n => !isNaN(n)))).sort((a,b)=>a-b);
  wrapper.innerHTML = areas
    .map(a => `<li><a href='#' data-value='${a}' class='block px-4 py-2 hover:bg-purple-100'>${a} м²</a></li>`)
    .join('');
}

// 12. Лейблы кнопок
function updateFilterButtonLabels(filters) {
  ['place','purpose','minArea','maxArea'].forEach(key => {
    const wrapper = document.querySelector(`[data-filter-key='${key}']`);
    if (!wrapper) return;
    const btn = wrapper.querySelector('.filter-toggle');
    const lbl = btn.querySelector('.filter-label');
    const val = filters[key];
    if (val) {
      let text;
      if (key === 'purpose') text = labels[val];
      else if (key === 'minArea') text = `Площадь от ${val} м²`;
      else if (key === 'maxArea') text = `Площадь до ${val} м²`;
      else text = val;
      lbl.textContent = text;
      btn.classList.add('bg-indigo-600','text-white');
    } else {
      lbl.textContent = key==='minArea' ? 'Площадь от' : key==='maxArea' ? 'Площадь до' : btn.dataset.placeholder;
      btn.classList.remove('bg-indigo-600','text-white');
    }
  });
}
function renderListings(filters, suitableFilters) {
  const container = document.getElementById('listings');

  // 1) Фильтрация списка
  let list = filters.purpose && dataByPurpose[filters.purpose]
    ? dataByPurpose[filters.purpose]
    : Object.values(dataByPurpose).flat();
  list = list.filter(item => {
    if (filters.place && item.place !== filters.place) return false;
    if (filters.minArea && +item.area < +filters.minArea) return false;
    if (filters.maxArea && +item.area > +filters.maxArea) return false;
    if (suitableFilters.length) {
      if (!Array.isArray(item.suitableFor)) return false;
      if (!item.suitableFor.some(s => suitableFilters.includes(s))) return false;
    }
    return true;
  });
  updateAreaFilterOptions(list, filters);

  // 2) Если нет результатов — вставляем карусель "Похожее"
  if (!list.length) {
    const similar = filters.purpose && dataByPurpose[filters.purpose]
      ? dataByPurpose[filters.purpose]
      : [];

    // Собираем HTML слайдов
    const slidesHtml = similar.map(item => {
      const url = `detail.html?purpose=${filters.purpose||'land'}&id=${item.id}`;
      return `
        <div class="slide flex-none">
          <div class="bg-white rounded-lg shadow p-4 flex flex-col justify-between h-full">
            <img src="${Array.isArray(item.images)?item.images[0]:item.images}"
                 alt="${item.name}"
                 class="w-full h-44 object-cover rounded mb-3"
                 onerror="this.src='https://placehold.co/400x200?text=No+Image'">
            <div class="text-center font-medium mb-2">${item.name}</div>
            <p class="text-gray-600 text-sm mb-4 text-center">Площадь: ${item.area.toLocaleString("ru-RU")} м²</p>
            <div class="text-right">
              <a href="${url}" class="text-blue-600 hover:underline font-medium">Подробнее</a>
            </div>
          </div>
        </div>`;
    }).join('');

    container.innerHTML = `
      <div class="col-span-full w-full flex flex-col md:flex-row gap-6 p-6">
        <div class="md:w-2/3 flex flex-col items-center text-center space-y-4">

  <p class="text-2xl font-bold text-gray-800">По вашим критериям ничего не найдено</p>

  <p class="text-gray-600">
    Возможно, стоит расширить диапазон площадей или изменить область поиска. 
    А пока наш менеджер может помочь подобрать альтернативные варианты под ваши задачи.
  </p>

  <button id="contactManagerBtn"
          class="inline-flex items-center bg-gradient-to-r from-purple-600 to-indigo-600 
                 hover:from-purple-700 hover:to-indigo-700 text-white font-medium 
                 px-8 py-3 rounded-full shadow-lg transition-transform 
                 transform hover:-translate-y-0.5">
    <i class="fas fa-headset mr-2"></i>
    Получить помощь менеджера
  </button>
</div>
        <div class="md:w-1/3">
          <h2 class="text-lg font-medium mb-4">Похожее</h2>
          <div id="similar-slider-container" class="relative overflow-hidden">
            <div id="similar-slider-track"
                 class="inline-flex gap-4 transition-transform duration-500 ease-in-out">
              ${slidesHtml}
            </div>
          </div>
        </div>
      </div>`;

    // 3) Инициализация слайдера
    setTimeout(() => {
      const sliderContainer = document.getElementById('similar-slider-container');
      const sliderTrack     = document.getElementById('similar-slider-track');
      const slides          = sliderTrack.querySelectorAll('.slide');
      const totalSlides     = slides.length;
      if (totalSlides <= 1) return;

      // вычисляем gap между слайдами
      const style     = getComputedStyle(sliderTrack);
      const gap       = parseFloat(style.gap) || 0;

      let currentIndex = 0;
      let containerW   = sliderContainer.clientWidth;
      // задаём каждой .slide ровно ширину контейнера
      slides.forEach(sl => sl.style.width = `${containerW}px`);

      // общая ширина шага = ширина + gap
      const stepWidth = containerW + gap;

      // функция смещения
      function updatePosition(idx) {
        sliderTrack.style.transform = `translateX(${-idx * stepWidth}px)`;
      }

      // автопрокрутка
      const intervalId = setInterval(() => {
        currentIndex = (currentIndex + 1) % totalSlides;
        updatePosition(currentIndex);
      }, 3000);

      // стрелки навигации
      const nav = document.createElement('div');
      nav.className = 'absolute inset-y-0 left-0 right-0 flex justify-between items-center pointer-events-none';
      const btnPrev = document.createElement('button');
      btnPrev.innerHTML = '&#10094;'; btnPrev.className = 'pointer-events-auto bg-white rounded-full p-2 shadow';
      const btnNext = document.createElement('button');
      btnNext.innerHTML = '&#10095;'; btnNext.className = 'pointer-events-auto bg-white rounded-full p-2 shadow';
      nav.append(btnPrev, btnNext);
      sliderContainer.append(nav);

      btnPrev.addEventListener('click', () => {
        clearInterval(intervalId);
        currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
        updatePosition(currentIndex);
      });
      btnNext.addEventListener('click', () => {
        clearInterval(intervalId);
        currentIndex = (currentIndex + 1) % totalSlides;
        updatePosition(currentIndex);
      });

      // пересчёт при ресайзе
      window.addEventListener('resize', () => {
        containerW = sliderContainer.clientWidth;
        slides.forEach(sl => sl.style.width = `${containerW}px`);
        const newStep = containerW + gap;
        sliderTrack.style.transition = 'none';
        sliderTrack.style.transform  = `translateX(${-currentIndex * newStep}px)`;
        requestAnimationFrame(() => {
          sliderTrack.style.transition = '';
        });
      });
    }, 0);

    return;
  }

  // 4) Обычная отрисовка результатов
  container.innerHTML = list.map(item => {
    let p = filters.purpose;
    if (!p) {
      for (const k in dataByPurpose) {
        if (dataByPurpose[k].includes(item)) { p = k; break; }
      }
    }
    const href = `detail.html?purpose=${p||'land'}&id=${item.id}`;
    return `
      <a href="${href}" class="block bg-white rounded-lg shadow hover:shadow-lg transition overflow-hidden">
        <img src="${Array.isArray(item.images)?item.images[0]:item.images}"
             alt="${item.name}"
             class="w-full h-32 object-cover"
             onerror="this.src='https://placehold.co/400x200?text=Image+Not+Found'">
        <div class="p-4">
          <h3 class="font-semibold mb-1">${item.name}</h3>
          <p class="text-gray-600 text-sm mb-2">Площадь: ${item.area.toLocaleString("ru-RU")} м²</p>
          ${item.place ? `<p class="text-gray-500 text-xs mb-2">${item.place}</p>` : ''}
          <p class="text-blue-600 hover:text-blue-800 font-medium flex items-center">
            Подробнее <i class="fas fa-arrow-right ml-2"></i>
          </p>
        </div>
      </a>`;
  }).join('');
}



// 14. Обновление опций площадей
function updateAreaFilterOptions(filtered, filters) {
  ['minArea','maxArea'].forEach(key => {
    const menu = document.querySelector(`[data-filter-key='${key}'] .filter-options`);
    if (!menu) return;
    let vals = Array.from(new Set(filtered.map(i=>Number(i.area)).filter(n=>!isNaN(n)))).sort((a,b)=>a-b);
    if (key==='minArea' && filters.maxArea) vals=vals.filter(a=>a<=Number(filters.maxArea));
    if (key==='maxArea' && filters.minArea) vals=vals.filter(a=>a>=Number(filters.minArea));
    menu.innerHTML = vals.map(a=>`<li><a href='#' data-value='${a}' class='block px-4 py-2 hover:bg-indigo-600 hover:text-white'>${a} м²</a></li>`).join('');
  });
}

// 15. Обработчики фильтров
function attachFilterHandlers(filters, url, suitableFilters) {
  document.querySelectorAll('.relative[data-filter-key]').forEach(wrapper => {
    const key=wrapper.dataset.filterKey;
    const btn=wrapper.querySelector('.filter-toggle');
    const menu=wrapper.querySelector('.filter-options');
    btn.addEventListener('click',e=>{e.stopPropagation();document.querySelectorAll('.filter-options.show').forEach(m=>m.classList.remove('show'));menu.classList.toggle('show');});
    menu.addEventListener('click',e=>{
      const opt=e.target.closest('a[data-value]');if(!opt)return;e.preventDefault();
      const val=opt.dataset.value;let reset=(val==='');if((key==='minArea'||key==='maxArea')&&filters[key]===val)reset=true;
      if(reset)delete filters[key];else if(key==='purpose'){
        filters.purpose=val;const items=dataByPurpose[val]||[];const areas=items.map(i=>Number(i.area)).filter(n=>!isNaN(n));
        if(areas.length){filters.minArea=String(Math.min(...areas));filters.maxArea=String(Math.max(...areas));}
        else{delete filters.minArea;delete filters.maxArea;}
        updateFilterButtonLabels(filters);
        updateAreaFilterOptions(items,filters);
      }else{
        filters[key]=val; if(filters.minArea&&filters.maxArea&&Number(filters.minArea)>Number(filters.maxArea)){delete filters.minArea;delete filters.maxArea;}
      }
      ['purpose','place','minArea','maxArea'].forEach(k=>filters[k]?url.searchParams.set(k,filters[k]):url.searchParams.delete(k));
      history.pushState(null,'',url);
      updateFilterButtonLabels(filters);
      if(key==='purpose')updateBreadcrumbAndHeading(filters.purpose);
      renderListings(filters,suitableFilters);
      menu.classList.remove('show');
    });
  });
  document.addEventListener('click',()=>document.querySelectorAll('.filter-options.show').forEach(m=>m.classList.remove('show')));
}


</script>


    <!-- Modal -->
    <div id="modal" class="modal fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="modal-overlay absolute inset-0"></div>
        <div class="modal-container bg-white w-full max-w-md mx-auto rounded-lg shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 px-6">
                <div class="flex justify-between items-center pb-3">
                    <h3 class="text-xl font-bold">Оставьте заявку</h3>
                    <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <form id="contactForm" class="space-y-4">
                    <div>
                        <label for="name" class="block text-gray-700 mb-1">Имя <span
                                class="text-red-500">*</span></label>
                        <input type="text" id="name"
                            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            required>
                    </div>

                    <div>
                        <label for="phone" class="block text-gray-700 mb-1">Телефон <span
                                class="text-red-500">*</span></label>
                        <input type="tel" id="phone"
                            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            required>
                    </div>

                    <div>
                        <label for="email" class="block text-gray-700 mb-1">Email</label>
                        <input type="email" id="email"
                            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <div>
                        <label for="property-type" class="block text-gray-700 mb-1">Тип недвижимости</label>
                        <select id="property-type"
                            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Выберите тип</option>
                            <option value="apartment">Квартира</option>
                            <option value="house">Дом</option>
                            <option value="office">Офис</option>
                            <option value="commercial">Коммерческая</option>
                        </select>
                    </div>

                    <div>
                        <label for="message" class="block text-gray-700 mb-1">Сообщение</label>
                        <textarea id="message" rows="3"
                            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>

                    <div class="text-sm text-gray-500">
                        <span class="text-red-500">*</span> Обязательные поля. Мы свяжемся с вами в течение 30 минут.
                    </div>

                    <button type="submit"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium transition">
                        Отправить заявку
                    </button>
                </form>
            </div>
        </div>
    </div>


</body>

</html>






